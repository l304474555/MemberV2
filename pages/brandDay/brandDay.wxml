<!--pages/brandDay/brandDay.wxml-->
<import src="../../wxParse/wxParse.wxml" />

<!-- <view class="backGroundImg"></view> -->

<movable-area class="movable-area">
  <movable-view direction="all" out-of-bounds="true" style="width:75rpx;height:75rpx;position:fixed;z-index:2;" x="300" y="520" wx:if="{{isBrandMember==true}}">
    <view class='head_kf2'>
      <image src='{{brandDayInfo.DrawIcon}}' style="height:50px;width:50px;" bindtap="openDraw"></image>
    </view>
  </movable-view>
</movable-area>



<!-- 获取用户信息组件 -->
<view class="modal_bg" style="{{isShowUserInfoBtn?'display:block':'display:none'}}"></view>
<view class='modal_fa2' style="{{isShowUserInfoBtn?'display:block':'display:none'}}">
  <view style="padding:30px 10px;">
    <view class="modal_txt">无法获取您的用户信息，请授权给我们应用以正常使用本应用的相关功能。</view>
    <button class='modal_btn' open-type='getUserInfo' bindgetuserinfo='getUserInfoBtnClick'>确定</button>
  </view>
</view>

<!-- 注册会员组件 -->
<regesmember id="regerter"></regesmember>

<!-- 查看详情弹框 -->
<cover-view class="modal_bg" style="{{isShowDetails?'display:block':'display:none'}}"></cover-view>
<cover-view class="modal_fa2" style="top:50%; margin-top:-210px;text-align:left; width:85%;{{isShowDetails?'display:block':'display:none'}}">
  <cover-view style="padding:12px 10px 20px 10px;">

    <cover-view class='modal_close3_new' bindtap='closeTask' style="width: 25px;height: 25px;">
      <cover-image src="../img/y_close2.png" mode="widthFix" style="width: 25px;height: 25px;"></cover-image>
    </cover-view>

    <cover-view class="modal_title">品牌权益</cover-view>

    <cover-view class='modal_value_txt_ot_fa'>
      <cover-view class='modal_value_txt_ot' style="overflow:scroll;height:200px;overflow-y: scroll;">
        <template is="wxParseBrand" data="{{wxParseData:article.nodes}}" />
      </cover-view>
    </cover-view>

    <cover-view class="modal_btn_fa">
      <button class='modal_btn' hover-stop-propagation="true" style="margin-top:20px;display:inline-block;background-color: #D3D3D3;color:black;" bindtap="closeTask">知道了</button>
    </cover-view>
  </cover-view>
</cover-view>

<view class="returnHomePage" bindtap="returnHomePage">
  <image src="../img/member_kf.png"></image>
</view>

<view class="brand-day">
  <view class="memberCard">
    <image src="../img/brandDay/brand_member_card-min.png"></image>
    <view class="barCode" wx:if="{{brandDayInfo.Id!=null && memberStatus==200}}">
      <view class='barCodeTitle'>会员条形码每60秒刷新，截图无效</view>
      <view class="barCodePic">
        <canvas canvas-id="barcode" />
      </view>
      <view class='barCodeNum'>
        <view class='barCodeNumBody'>{{barCodeNum}}</view>
      </view>
      <view bindtap='getBarCode' wx:if="{{isCodeError}}" style="background:#fff;text-align:center; width:100%;color:#ccc;">会员条形码已过期，请点击刷新</view>
    </view>
    <!-- <view class="memberCode" bindtap="showMemberCode">
      <image src="../img/brandDay/code_icon-min.png" mode="widthFix"></image>
      <text>会员码</text>
      <image src="../img/brandDay/right_icon-min.png" mode="widthFix"></image>
    </view> -->
    <view class="position">
      <view class="positionBody" catchtap="changeCity">
        <image src="../img/brandDay/location_icon-min.png" mode="widthFix" class="positionIcon"></image>
        <text>{{cityName}}</text>
      </view>
    </view>
    <view class="memberInfo" wx:if="{{isBrandMember==true}}">
      <image src="../img/brandDay/brand_member_icon-min.png"></image>
      <view class="memberText">
        <text>专享品牌会员</text>
      </view>
    </view>
  </view>

  <view class="separator" wx:if="{{brandDayInfo.Id!=null}}">
    <text>· ————— ·  品牌权益  · ————— · </text>
  </view>
  <view class="brandList">
    <block wx:for="{{brandList}}">
      <view class="brandItem">
        <view class="brandCheckbox">
          <image src="../img/brandDay/brand_member_open-min.png" wx:if="{{item.IsOpen==1}}"></image>
          <checkbox-group bindchange="checkboxChange" data-checkid="{{index}}" style="{{item.IsOpen==1?'display:none':'display:inline-block'}}">
            <checkbox disabled="{{item.State==3 || item.IsFull==1}}" checked="{{item.isSelected}}"></checkbox>
          </checkbox-group>
        </view>

        <view class="brandBody" bindtap="viewDetails" data-id="{{item.Id}}" data-state="{{item.State}}" data-isFull="{{item.IsFull}}">
          <view class="shelter" wx:if="{{item.State==3 || item.IsFull==1}}">
            <image wx:if="{{item.State==3}}" src="../img/brandDay/coming_soon-min.png" mode="widthFix"></image>
            <image wx:if="{{item.IsFull==1}}" src="../img/brandDay/full-min.png" mode="widthFix"></image>
          </view>
          <text wx:if="{{item.State!=3}}" style="color: white;font-family: 'Alibaba';font-size: 12px;position: absolute;margin-left: 80px;display:flex;height:80px;align-items:center;">
        <text style="font-size:14px;">查看详情</text> 
        有效期至{{item.EndTime}}
          </text>
          <image src="{{item.BgImage}}"></image>
          <view></view>
        </view>
      </view>
      <view class="brandTip" wx:if="{{item.IsOpen==1}}">可享受优惠{{item.DisountCnt.DayCnt}}次，今天剩余{{item.DisountCnt.BalanceCnt}}次</view>
    </block>

  </view>
  <view class="brandAmount" wx:if="{{isBrandCheck==true}}">
    <text class="brandAmountInfoTxt">开通品牌会员卡：共需 </text>
    <text class="brandAmountNumTxt"> {{brandAmount}} </text>
    <text class="brandAmountInfoTxt"> 元</text>
  </view>
  <view class="agreement" wx:if="{{brandDayInfo.Id!=null}}">
    <checkbox-group bindchange="agreementCheckBoxChange">
      <checkbox></checkbox>
    </checkbox-group>
    <text>已阅读并同意《</text>
    <text style="text-decoration:underline;z-index:1;" bindtap="openAgreement">品牌会员权益协议</text>
    <text>》</text>
  </view>
  <view class="openBtn">
    <image src="{{brandDayInfo.OpenIcon}}" bindtap="openBrand"></image>
  </view>
  <view class="separator" style="margin-top:30px;" wx:if="{{brandDayInfo.Id!=null}}">
    <text>· ————— ·  活动规则  · ————— · </text>
  </view>
  <view class="rule" wx:if="{{brandDayInfo.Id!=null}}">
    <template is="wxParse" data="{{wxParseData:rule.nodes}}" />
  </view>
</view>


<image src="{{brandDayInfo.PageBgImage}}" class="backGroundImg"></image>